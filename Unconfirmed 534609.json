{
  "name": "My workflow 2",
  "nodes": [
    {
      "parameters": {
        "command": "=/usr/bin/wget --post-data='{\"isActive\":\"active\",\"isMasterOrient\":false,\"moSemester\":\"\",\"isUniversity\":false,\"EducationLevel\":\"all\",\"AdmissionType\":\"all\",\"Capacity\":\"all\",\"ideaType\":\"all\",\"level1\":[],\"level2\":[],\"level3\":[],\"ministry\":[],\"organization\":[],\"awards\":[],\"ideaTemplate\":[],\"province\":[{\"id\":11,\"name\":\"Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ\"}],\"city\":[],\"trl\":[1,9],\"mode\":\"challenges\",\"searchedText\":\"\",\"sort\":\"regDate\",\"order\":\"desc\",\"page\":1,\"pageSize\":1000}' --header='Accept: application/json, text/plain, */*' --header='Accept-Language: en,fa;q=0.9,en-US;q=0.8' --header='Cache-Control: no-cache' --header='Content-Type: application/json' --header='Origin: https://nan.ac' --header='Port: 1' --header='Referer: https://nan.ac/' --header='User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36' -O- -q 'https://test.nan.ac/api/v1/Need/GetAllNeeds'"
      },
      "id": "4cce2cda-33dd-4549-8a6a-ad3494bf4c2e",
      "name": "Fetch NAN Challenges (cURL)",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        416,
        -64
      ]
    },
    {
      "parameters": {
        "jsCode": "// ØªØ¨Ø¯ÛŒÙ„ Ø®Ø±ÙˆØ¬ÛŒ cURL Ø¨Ù‡ JSON Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ù…Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§\nconst items = $input.all();\nconst allResults = [];\nlet totalItemsInResponse = 0;\nlet successfullyParsed = 0;\nlet errors = 0;\n\nitems.forEach((item, itemIndex) => {\n  const stdout = item.json.stdout || item.json.data || '';\n  \n  console.log(`[Parse cURL Response] Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¢ÛŒØªÙ… ${itemIndex + 1} Ø§Ø² ${items.length}`);\n  console.log(`[Parse cURL Response] Ø·ÙˆÙ„ stdout: ${stdout.length} Ú©Ø§Ø±Ø§Ú©ØªØ±`);\n  \n  try {\n    const jsonData = JSON.parse(stdout);\n    \n    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢Ø±Ø§ÛŒÙ‡ Ù‡Ø³Øª ÛŒØ§ object\n    if (Array.isArray(jsonData)) {\n      totalItemsInResponse = jsonData.length;\n      console.log(`[Parse cURL Response] âœ… API ÛŒÚ© Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§ ${totalItemsInResponse} Ø¢ÛŒØªÙ… Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†Ø¯Ù‡`);\n      \n      // Ø§Ú¯Ø± Ø¢Ø±Ø§ÛŒÙ‡ Ù‡Ø³ØªØŒ Ù‡Ø± Ø¢ÛŒØªÙ… Ø±Ùˆ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†\n      jsonData.forEach((need, needIndex) => {\n        allResults.push({ json: need });\n        successfullyParsed++;\n        \n        // Ù„Ø§Ú¯ Ù‡Ø± Û±Û° Ø¢ÛŒØªÙ…\n        if ((needIndex + 1) % 10 === 0) {\n          console.log(`[Parse cURL Response] Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯: ${needIndex + 1}/${totalItemsInResponse}`);\n        }\n      });\n      \n      console.log(`[Parse cURL Response] âœ… ØªÙ…Ø§Ù… ${successfullyParsed} Ø¢ÛŒØªÙ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯`);\n    } else {\n      // Ø§Ú¯Ø± object Ù‡Ø³ØªØŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†\n      totalItemsInResponse = 1;\n      allResults.push({ json: jsonData });\n      successfullyParsed++;\n      console.log(`[Parse cURL Response] âœ… ÛŒÚ© object Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†Ø¯Ù‡ Ø´Ø¯`);\n    }\n  } catch (error) {\n    errors++;\n    console.error(`[Parse cURL Response] âŒ Ø®Ø·Ø§ Ø¯Ø± parse Ú©Ø±Ø¯Ù† JSON:`, error.message);\n    console.error(`[Parse cURL Response] Ø§ÙˆÙ„ÛŒÙ† ÛµÛ°Û° Ú©Ø§Ø±Ø§Ú©ØªØ± stdout:`, stdout.substring(0, 500));\n    \n    allResults.push({\n      json: {\n        error: 'Failed to parse JSON',\n        rawOutput: stdout.substring(0, 1000),\n        errorMessage: error.message,\n        stdoutLength: stdout.length\n      }\n    });\n  }\n});\n\n// Ù†Ù…Ø§ÛŒØ´ Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ\nconsole.log(`\\n========== Ø®Ù„Ø§ØµÙ‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ ==========`);\nconsole.log(`ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ API: ${totalItemsInResponse}`);\nconsole.log(`âœ… ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡: ${successfullyParsed}`);\nconsole.log(`âŒ ØªØ¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ù‡Ø§: ${errors}`);\nconsole.log(`ğŸ“¤ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÙˆØ¬ÛŒ: ${allResults.length}`);\nconsole.log(`====================================\\n`);\n\n// Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÛŒÚ© Ø¢ÛŒØªÙ… Ø®Ù„Ø§ØµÙ‡ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ Ø¢Ø±Ø§ÛŒÙ‡\nif (allResults.length > 0 && !allResults[0].json.error) {\n  allResults.unshift({\n    json: {\n      _summary: true,\n      totalItemsFromAPI: totalItemsInResponse,\n      successfullyParsed: successfullyParsed,\n      errors: errors,\n      outputItems: allResults.length,\n      timestamp: new Date().toISOString(),\n      message: `âœ… Ø§Ø² ${totalItemsInResponse} Ø¢ÛŒØªÙ… APIØŒ ${successfullyParsed} Ù…ÙˆØ±Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯`\n    }\n  });\n}\n\nreturn allResults;"
      },
      "id": "0cb542cc-5377-41ca-aae0-da35e2c4db2d",
      "name": "Parse cURL Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        560,
        192
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 12
            }
          ]
        }
      },
      "id": "2d352f18-8823-4896-ae6a-4fa950797f34",
      "name": "Every 12 Hours2",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        192,
        -64
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ API Ùˆ ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ\nconst items = $input.all();  // Ù‡Ù…Ù‡ items Ø±Ùˆ Ø¨Ú¯ÛŒØ±\n\n// ØªØ§Ø¨Ø¹ ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ\nconst faNums = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];\nfunction toFaDigits(s) {\n  if (s === null || s === undefined) return '';\n  return String(s).replace(/\\d/g, d => faNums[Number(d)]);\n}\n\nconst challenges = [];\nlet totalProcessed = 0;\n\ntry {\n  // Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªÙ…Ø§Ù… items\n  items.forEach(item => {\n    const need = item.json;\n    totalProcessed++;\n    \n    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ù…Ù…Ú©Ù†Ù‡ Ø§Ø³ØªØ§Ù† Ø¯Ø§Ø®Ù„Ø´ Ø¨Ø§Ø´Ù‡\n    const mainLogoName = need.mainLogoName || '';\n    const title = need.title || '';\n    const secondaryLogoName = need.secondaryLogoName || '';\n    const dor = need.dor || '';\n    \n    // Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ - Ø¨Ø§ ØªÙ…Ø§Ù… Ø­Ø§Ù„Ø§Øª Ù…Ù…Ú©Ù†\n    const searchText = `${mainLogoName} ${title} ${secondaryLogoName} ${dor}`.toLowerCase();\n    \n    const isKhorasanRazavi = \n      searchText.includes('Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ') ||\n      searchText.includes('Ø®Ø±Ø§Ø³Ø§Ù†â€ŒØ±Ø¶ÙˆÛŒ') ||\n      searchText.includes('Ø®Ø±Ø§Ø³Ø§Ù†Ø±Ø¶ÙˆÛŒ') ||\n      searchText.includes('Ø®Ø±Ø§Ø³Ø§Ù†') ||\n      searchText.includes('Ù…Ø´Ù‡Ø¯') ||\n      searchText.includes('khorasan razavi') ||\n      searchText.includes('khorasan') ||\n      mainLogoName.includes('Ø®Ø±Ø§Ø³Ø§Ù†') ||\n      title.includes('Ø®Ø±Ø§Ø³Ø§Ù†');\n    \n    if (isKhorasanRazavi) {\n      const id = need.id || '';\n      const titleText = need.title || '';\n      \n      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ø¯Ø§Ø´ Ø§Ø² item1\n      const reward = need.item1?.text || '';\n      const rewardTooltip = need.item1?.tooltip || '';\n      \n      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØ¹Ø¯Ø§Ø¯ Ø§ÛŒØ¯Ù‡ Ø§Ø² item2\n      const ideasCount = need.item2?.text || '0';\n      \n      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù‡Ù„Øª Ø§Ø² item3\n      const deadline = need.item3?.text || dor || '';\n      \n      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§Ø² item4\n      const viewCount = need.item4?.text || '0';\n      \n      // Ø³Ø§Ø²Ù…Ø§Ù†\n      const organization = mainLogoName || 'NAN';\n      \n      // Ù„ÛŒÙ†Ú©\n      const link = `https://nan.ac/challenges/${id}`;\n      \n      challenges.push({\n        id: id,\n        title: titleText,\n        province: 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ',\n        organization: organization,\n        deadline: deadline,\n        reward: reward,\n        rewardType: rewardTooltip,\n        ideasCount: ideasCount,\n        viewCount: viewCount,\n        dor: dor,\n        ribbon: need.ribbon || null,\n        stamp: need.stamp || null,\n        link: link,\n        mainLogoName: mainLogoName,\n        secondaryLogoName: secondaryLogoName || null\n      });\n    }\n  });\n  \n} catch (error) {\n  return [{\n    json: {\n      success: false,\n      error: error.message,\n      errorStack: error.stack,\n      challenges: [],\n      totalProcessed: totalProcessed\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    success: true,\n    challenges: challenges,\n    count: challenges.length,\n    totalProcessed: totalProcessed,\n    province: 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ',\n    note: `Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´Ø¯: ${totalProcessed} Ù†ÛŒØ§Ø² - Ù¾ÛŒØ¯Ø§ Ø´Ø¯: ${challenges.length} Ù…ÙˆØ±Ø¯ Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ`\n  }\n}];"
      },
      "id": "b15d7c14-c5cc-4d26-9d39-38f0c31167bb",
      "name": "Parse & Filter Khorasan Challenges2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        736,
        192
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ùˆ ØªØ´Ø®ÛŒØµ ØªØºÛŒÛŒØ±Ø§Øª\nconst data = $input.item.json;\nconst currentChallenges = data.challenges || [];\n\nconst workflowStaticData = $getWorkflowStaticData('global');\nconst previousChallenges = workflowStaticData.nanChallenges || {};\n\nconst newChallenges = [];\nconst updatedChallenges = [];\nconst unchangedChallenges = [];\n\nconst currentChallengesMap = {};\ncurrentChallenges.forEach(challenge => {\n  const key = challenge.title.trim();\n  currentChallengesMap[key] = challenge;\n});\n\ncurrentChallenges.forEach(challenge => {\n  const key = challenge.title.trim();\n  const prevChallenge = previousChallenges[key];\n  \n  if (!prevChallenge) {\n    newChallenges.push({\n      ...challenge,\n      changeType: 'new'\n    });\n  } else {\n    const changes = [];\n    \n    if (prevChallenge.deadline !== challenge.deadline) {\n      changes.push({\n        field: 'Ù…Ù‡Ù„Øª',\n        oldValue: prevChallenge.deadline,\n        newValue: challenge.deadline\n      });\n    }\n    \n    if (prevChallenge.description !== challenge.description) {\n      changes.push({\n        field: 'ØªÙˆØ¶ÛŒØ­Ø§Øª',\n        oldValue: prevChallenge.description,\n        newValue: challenge.description\n      });\n    }\n    \n    if (changes.length > 0) {\n      updatedChallenges.push({\n        ...challenge,\n        changeType: 'updated',\n        changes: changes\n      });\n    } else {\n      unchangedChallenges.push({\n        ...challenge,\n        changeType: 'unchanged'\n      });\n    }\n  }\n});\n\nworkflowStaticData.nanChallenges = currentChallengesMap;\nworkflowStaticData.lastCheckTime = new Date().toISOString();\n\nreturn [{\n  json: {\n    success: true,\n    newCount: newChallenges.length,\n    updatedCount: updatedChallenges.length,\n    unchangedCount: unchangedChallenges.length,\n    totalCount: currentChallenges.length,\n    newChallenges: newChallenges,\n    updatedChallenges: updatedChallenges,\n    unchangedChallenges: unchangedChallenges,\n    hasChanges: (newChallenges.length > 0 || updatedChallenges.length > 0)\n  }\n}];"
      },
      "id": "c4438539-3ff3-4dbe-9af1-47c37117a6b5",
      "name": "Detect Changes3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        928,
        -16
      ]
    },
    {
      "parameters": {
        "jsCode": "// Ø³Ø§Ø®Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Telegram\nconst data = $input.item.json;\nconst newChallenges = data.newChallenges || [];\nconst updatedChallenges = data.updatedChallenges || [];\n\nif (!data.hasChanges) {\n  return [{\n    json: {\n      send: false,\n      message: 'âœ… *Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯*\\n\\nÙ‡ÛŒÚ† Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯ ÛŒØ§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¯Ø± Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.',\n      messageType: 'no_changes'\n    }\n  }];\n}\n\nconst faNums = ['Û°','Û±','Û²','Û³','Û´','Ûµ','Û¶','Û·','Û¸','Û¹'];\nfunction toFaDigits(s) {\n  if (s === null || s === undefined) return '';\n  return String(s).replace(/\\d/g, d => faNums[Number(d)]);\n}\n\nconst messages = [];\n\n// Ù¾ÛŒØ§Ù… Ø®Ù„Ø§ØµÙ‡\nlet summaryMsg = `ğŸ”” *Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¢ÙˆØ±ÛŒ â€” Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ*\\n\\n`;\nif (newChallenges.length > 0) {\n  summaryMsg += `ğŸ†• Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯: ${toFaDigits(newChallenges.length)}\\n`;\n}\nif (updatedChallenges.length > 0) {\n  summaryMsg += `ğŸ”„ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡: ${toFaDigits(updatedChallenges.length)}\\n`;\n}\nsummaryMsg += `\\nğŸ“… Ø²Ù…Ø§Ù† Ø¨Ø±Ø±Ø³ÛŒ: ${new Date().toLocaleString('fa-IR')}\\n\\n`;\nsummaryMsg += `_Ø¯Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯._`;\n\nmessages.push({\n  json: {\n    send: true,\n    message: summaryMsg,\n    messageType: 'summary',\n    index: 0\n  }\n});\n\n// Ù¾ÛŒØ§Ù… Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯\nnewChallenges.forEach((challenge, index) => {\n  let msg = `ğŸ†• *Ú†Ø§Ù„Ø´ Ù†ÙˆØ¢ÙˆØ±ÛŒ Ø¬Ø¯ÛŒØ¯*\\n\\n`;\n  \n  if (challenge.title) {\n    msg += `*ğŸ“Œ Ø¹Ù†ÙˆØ§Ù†:*\\n${challenge.title}\\n\\n`;\n  }\n  \n  if (challenge.organization) {\n    msg += `*ğŸ¢ Ø³Ø§Ø²Ù…Ø§Ù†:*\\n${challenge.organization}\\n\\n`;\n  }\n  \n  if (challenge.reward) {\n    msg += `*ğŸ’° ${challenge.rewardType || 'Ù¾Ø§Ø¯Ø§Ø´'}:*\\n${challenge.reward}\\n\\n`;\n  }\n  \n  if (challenge.deadline) {\n    msg += `*â° Ù…Ù‡Ù„Øª:*\\n${challenge.deadline}\\n\\n`;\n  }\n  \n  if (challenge.ideasCount) {\n    msg += `*ğŸ’¡ ØªØ¹Ø¯Ø§Ø¯ Ø§ÛŒØ¯Ù‡:* ${toFaDigits(challenge.ideasCount)}\\n`;\n  }\n  \n  if (challenge.viewCount) {\n    msg += `*ğŸ‘ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²Ø¯ÛŒØ¯:* ${toFaDigits(challenge.viewCount)}\\n`;\n  }\n  \n  msg += `*ğŸ“ Ø§Ø³ØªØ§Ù†:* Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ\\n\\n`;\n  \n  if (challenge.link) {\n    msg += `ğŸ”— [Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ùˆ Ø«Ø¨Øª Ø§ÛŒØ¯Ù‡](${challenge.link})\\n\\n`;\n  }\n  \n  msg += `_ğŸ¤– Ú†Ø§Ù„Ø´ Ø¬Ø¯ÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ${toFaDigits(index + 1)} Ø§Ø² ${toFaDigits(newChallenges.length)}_`;\n  \n  messages.push({\n    json: {\n      send: true,\n      message: msg,\n      messageType: 'new',\n      challenge: challenge,\n      index: messages.length\n    }\n  });\n});\n\n// Ù¾ÛŒØ§Ù… Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡\nupdatedChallenges.forEach((challenge, index) => {\n  let msg = `ğŸ”„ *Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú†Ø§Ù„Ø´ Ù†ÙˆØ¢ÙˆØ±ÛŒ*\\n\\n`;\n  \n  if (challenge.title) {\n    msg += `*ğŸ“Œ Ø¹Ù†ÙˆØ§Ù†:*\\n${challenge.title}\\n\\n`;\n  }\n  \n  msg += `*âœï¸ ØªØºÛŒÛŒØ±Ø§Øª:*\\n`;\n  \n  challenge.changes.forEach(change => {\n    msg += `\\nâ–«ï¸ *${change.field}*\\n`;\n    if (change.field === 'Ù…Ù‡Ù„Øª') {\n      msg += `   Ù‚Ø¨Ù„ÛŒ: ${toFaDigits(change.oldValue)}\\n`;\n      msg += `   Ø¬Ø¯ÛŒØ¯: ${toFaDigits(change.newValue)} âœ¨\\n`;\n    } else {\n      msg += `   Ù‚Ø¨Ù„ÛŒ: ${change.oldValue}\\n`;\n      msg += `   Ø¬Ø¯ÛŒØ¯: ${change.newValue} âœ¨\\n`;\n    }\n  });\n  \n  msg += `\\n*ğŸ“Š Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ:*\\n\\n`;\n  \n  if (challenge.organization) {\n    msg += `*ğŸ¢ Ø³Ø§Ø²Ù…Ø§Ù†:* ${challenge.organization}\\n`;\n  }\n  \n  if (challenge.deadline) {\n    msg += `*â° Ù…Ù‡Ù„Øª:* ${toFaDigits(challenge.deadline)}\\n`;\n  }\n  \n  if (challenge.link) {\n    msg += `\\nğŸ”— [Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª](${challenge.link})\\n\\n`;\n  }\n  \n  msg += `_ğŸ¤– Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ ${toFaDigits(index + 1)} Ø§Ø² ${toFaDigits(updatedChallenges.length)}_`;\n  \n  messages.push({\n    json: {\n      send: true,\n      message: msg,\n      messageType: 'updated',\n      challenge: challenge,\n      index: messages.length\n    }\n  });\n});\n\nreturn messages;"
      },
      "id": "c4890ed7-01ed-4e35-92c1-1cd7bb50f4d9",
      "name": "Format Telegram Messages3",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1088,
        -64
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.send }}",
              "value2": true
            }
          ]
        },
        "options": {}
      },
      "id": "b177af73-fe7b-4e96-8d68-ad7c2036b053",
      "name": "Should Send?3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1312,
        -64
      ]
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "42a7668f-d239-4a8b-b225-a478b5cef259",
      "name": "Wait Between Messages3",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1552,
        -64
      ],
      "webhookId": "wait-nan-messages"
    },
    {
      "parameters": {
        "chatId": "YOUR_TELEGRAM_CHAT_ID_HERE",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1792,
        -64
      ],
      "id": "941451ca-9dcb-4920-bee2-a1e9aea0607d",
      "name": "Send to Telegram3",
      "webhookId": "ed101e8b-c783-4a37-a9f9-c9e9be3f4022"
    },
    {
      "parameters": {
        "jsCode": "// ğŸ” Ù†ÙˆØ¯ Debug: Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‚ÛŒÙ‚ ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ\nconst items = $input.all();\n\nconsole.log(`\\n\\n`);\nconsole.log(`ğŸ” ========== DEBUG: ØªØ¹Ø¯Ø§Ø¯ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ ==========`);\nconsole.log(`ğŸ“Š ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ items Ø¯Ø±ÛŒØ§ÙØªÛŒ: ${items.length}`);\nconsole.log(`====================================================\\n`);\n\n// Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‡Ø± Ø¢ÛŒØªÙ…\nitems.forEach((item, index) => {\n  console.log(`ğŸ“¦ Ø¢ÛŒØªÙ… ${index + 1}:`);\n  \n  // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Summary Ø§Ø³Øª\n  if (item.json._summary) {\n    console.log(`   âš ï¸ Ø§ÛŒÙ† ÛŒÚ© Ø¢ÛŒØªÙ… Summary Ø§Ø³Øª`);\n    console.log(`   ğŸ“Š totalItemsFromAPI: ${item.json.totalItemsFromAPI}`);\n    console.log(`   âœ… successfullyParsed: ${item.json.successfullyParsed}`);\n    console.log(`   ğŸ’¬ message: ${item.json.message}`);\n  } else if (item.json.error) {\n    console.log(`   âŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø®Ø·Ø§ Ø¯Ø§Ø±Ø¯: ${item.json.error}`);\n  } else {\n    // Ù†Ù…Ø§ÛŒØ´ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ\n    console.log(`   ğŸ†” ID: ${item.json.id || 'N/A'}`);\n    console.log(`   ğŸ“ Title: ${item.json.title ? item.json.title.substring(0, 50) + '...' : 'N/A'}`);\n    console.log(`   ğŸ¢ mainLogoName: ${item.json.mainLogoName || 'N/A'}`);\n  }\n  console.log(``);\n});\n\nconsole.log(`\\nğŸ” ========== Ù¾Ø§ÛŒØ§Ù† DEBUG ==========\\n\\n`);\n\n// Ø®Ø±ÙˆØ¬ÛŒ Ø±Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø±Ú¯Ø±Ø¯ÙˆÙ†\nreturn items;"
      },
      "id": "debug-item-count-12345",
      "name": "ğŸ” Debug: Item Count",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        648,
        192
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Fetch NAN Challenges (cURL)": {
      "main": [
        [
          {
            "node": "Parse cURL Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse cURL Response": {
      "main": [
        [
          {
            "node": "ğŸ” Debug: Item Count",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ” Debug: Item Count": {
      "main": [
        [
          {
            "node": "Parse & Filter Khorasan Challenges2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Every 12 Hours2": {
      "main": [
        [
          {
            "node": "Fetch NAN Challenges (cURL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse & Filter Khorasan Challenges2": {
      "main": [
        [
          {
            "node": "Detect Changes3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Detect Changes3": {
      "main": [
        [
          {
            "node": "Format Telegram Messages3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Telegram Messages3": {
      "main": [
        [
          {
            "node": "Should Send?3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Should Send?3": {
      "main": [
        [
          {
            "node": "Wait Between Messages3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait Between Messages3": {
      "main": [
        [
          {
            "node": "Send to Telegram3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "0e381f34-afbd-4e2e-841e-88bc228ad01e",
  "meta": {
    "instanceId": "e0014d49ee7df39f8b8cac083fd591756af7807647929906bd8e545ef487fc2b"
  },
  "id": "eRqE9o8jpdwX9oc8",
  "tags": []
}