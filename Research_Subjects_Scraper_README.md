# 📚 Workflow استخراج موضوعات تحقیقاتی آبفای مشهد

این workflow برای استخراج خودکار موضوعات تحقیقاتی از سایت آبفای مشهد و ارسال آن‌ها به تلگرام طراحی شده است.

## 🎯 قابلیت‌ها

- ✅ استخراج خودکار داده‌ها از سایت `https://research.abfamashhad.ir/SubjectsList`
- ✅ پارس کردن جدول HTML و استخراج اطلاعات:
  - عنوان موضوع
  - نوع (پایان‌نامه کارشناسی ارشد، دکتری و...)
  - مهلت ثبت پروپوزال
  - جزئیات
- ✅ فرمت‌بندی زیبا با فونت فارسی و ایموجی
- ✅ ارسال به کانال تلگرام
- ✅ اجرای خودکار هر 6 ساعت

## ⚙️ نحوه راه‌اندازی

### 1. Import کردن Workflow

1. فایل `Research_Subjects_Scraper_Telegram.json` را باز کنید
2. محتوای آن را کپی کنید
3. در n8n به قسمت Workflows بروید
4. روی دکمه Import کلیک کنید
5. محتوا را Paste کنید

### 2. تنظیم Telegram Bot

قبل از استفاده، باید:

1. **ایجاد Bot تلگرام:**
   - به [@BotFather](https://t.me/botfather) در تلگرام پیام دهید
   - دستور `/newbot` را ارسال کنید
   - نام و username برای bot خود انتخاب کنید
   - Token دریافتی را کپی کنید

2. **دریافت Chat ID:**
   - Bot را به کانال خود اضافه کنید و Admin کنید
   - یا از [@userinfobot](https://t.me/userinfobot) برای دریافت Chat ID شخصی استفاده کنید
   - برای کانال، معمولاً Chat ID به صورت `-100xxxxxxxxxx` است

3. **تنظیم Credentials در n8n:**
   - در n8n به قسمت Credentials بروید
   - یک Telegram API credential جدید ایجاد کنید
   - Token بات را وارد کنید

4. **به‌روزرسانی Workflow:**
   - Node "Send to Telegram" را باز کنید
   - در قسمت `chatId` شناسه کانال یا چت خود را وارد کنید
   - Credential تلگرام خود را انتخاب کنید

### 3. تنظیم زمان‌بندی (اختیاری)

Node "Every 6 Hours" را می‌توانید تنظیم کنید:
- هر ساعت
- هر روز
- یا هر بازه زمانی دلخواه

### 4. فعال‌سازی Workflow

- روی دکمه "Active" در بالای صفحه کلیک کنید
- Workflow به‌طور خودکار در زمان‌های تعیین‌شده اجرا می‌شود

## 🧪 تست Workflow

برای تست دستی:
1. روی node "Every 6 Hours" کلیک راست کنید
2. گزینه "Execute Node" را انتخاب کنید
3. منتظر بمانید تا تمام nodeها اجرا شوند
4. نتایج را در تلگرام بررسی کنید

## 📋 ساختار Workflow

```
Every 6 Hours
    ↓
Fetch Research Subjects Page (HTTP Request)
    ↓
Parse HTML & Extract Data (Code)
    ↓
Format Telegram Messages (Code)
    ↓
Should Send? (IF)
    ↓
Wait Between Messages (Wait)
    ↓
Send to Telegram (Telegram)
```

## 🎨 فرمت پیام‌ها

پیام‌های ارسالی شامل موارد زیر هستند:

```
📚 موضوع تحقیقاتی جدید

📌 عنوان:
[عنوان موضوع]

🎓 نوع:
[نوع تحقیق]

⏰ مهلت ثبت پروپوزال:
[تاریخ به فارسی]

📋 جزئیات:
[جزئیات موضوع]

🔗 مشاهده در سایت

🤖 پیام خودکار — شماره ۱ از ۵
```

## 🔧 سفارشی‌سازی

### تغییر Headers

اگر سایت مسدود شد، می‌توانید در node "Fetch Research Subjects Page" Headers را تغییر دهید:
- User-Agent
- Accept-Language
- و سایر headerها

### تغییر پارسر HTML

در node "Parse HTML & Extract Data" می‌توانید:
- الگوی regex را برای استخراج داده‌ها تغییر دهید
- ستون‌های جدید اضافه کنید
- فرمت خروجی را تنظیم کنید

### تغییر فرمت پیام

در node "Format Telegram Messages":
- ایموجی‌ها را تغییر دهید
- فرمت‌بندی Markdown را شخصی‌سازی کنید
- فیلدهای جدید اضافه کنید

## ⚠️ نکات مهم

1. **محدودیت Rate Limiting:**
   - Node "Wait Between Messages" برای جلوگیری از محدودیت تلگرام 2 ثانیه تاخیر دارد
   - اگر تعداد پیام‌ها زیاد است، این مقدار را افزایش دهید

2. **بررسی ساختار سایت:**
   - اگر سایت تغییر کرد، باید Code node پارسر را به‌روزرسانی کنید
   - ابتدا صفحه HTML را دستی بررسی کنید

3. **امنیت:**
   - Token تلگرام خود را محفوظ نگه دارید
   - از Credentials n8n به جای hard-coding استفاده کنید

## 🐛 عیب‌یابی

### پیام ارسال نمی‌شود
- Chat ID را بررسی کنید (باید با `-` شروع شود برای کانال)
- Bot را Admin کانال کنید
- Credentials تلگرام را چک کنید

### داده استخراج نمی‌شود
- ساختار HTML سایت را بررسی کنید
- Code node "Parse HTML & Extract Data" را debug کنید
- Headers درخواست HTTP را بررسی کنید

### خطای 403
- User-Agent را تغییر دهید
- Headers بیشتری اضافه کنید
- از proxy استفاده کنید (در تنظیمات n8n)

## 📝 لایسنس

این workflow برای استفاده شخصی و آموزشی ارائه شده است.

## 🤝 مشارکت

برای گزارش مشکل یا پیشنهاد بهبود، Issue ایجاد کنید.

---

**ساخته شده با ❤️ برای جامعه n8n فارسی‌زبانان**
