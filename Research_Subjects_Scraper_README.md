# ๐ Workflow ุงุณุชุฎุฑุงุฌ ููุถูุนุงุช ุชุญููุงุช ุขุจูุง ูุดูุฏ

ุงู workflow ุจุฑุง ุงุณุชุฎุฑุงุฌ ุฎูุฏฺฉุงุฑ ููุถูุนุงุช ุชุญููุงุช ุงุฒ ุณุงุช ุขุจูุง ูุดูุฏ ู ุงุฑุณุงู ุขูโูุง ุจู ุชูฺฏุฑุงู ุทุฑุงุญ ุดุฏู ุงุณุช.

## ๐ฏ ูุงุจูุชโูุง

- โ ุงุณุชุฎุฑุงุฌ ุฎูุฏฺฉุงุฑ ุฏุงุฏูโูุง ุงุฒ ุณุงุช `https://research.abfamashhad.ir/SubjectsList`
- โ ูพุงุฑุณ ฺฉุฑุฏู ุฌุฏูู HTML ู ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุช:
  - ุนููุงู ููุถูุน
  - ููุน (ูพุงุงูโูุงูู ฺฉุงุฑุดูุงุณ ุงุฑุดุฏุ ุฏฺฉุชุฑ ู...)
  - ูููุช ุซุจุช ูพุฑููพูุฒุงู
  - ุฌุฒุฆุงุช
- โ **ุชุดุฎุต ููุดููุฏ ุชุบุฑุงุช:**
  - ุดูุงุณุง ููุถูุนุงุช ุฌุฏุฏ
  - ุชุดุฎุต ุชุบุฑ ุฏุฑ ูููุช ุซุจุช ูพุฑููพูุฒุงู
  - ุชุดุฎุต ุชุบุฑ ุฏุฑ ููุน ู ุฌุฒุฆุงุช
  - ููุงุด ููุงุณู ูุจู/ุจุนุฏ ุจุฑุง ุชุบุฑุงุช
- โ ูุฑูุชโุจูุฏ ุฒุจุง ุจุง ูููุช ูุงุฑุณ ู ุงููุฌ
- โ ุงุฑุณุงู ุจู ฺฉุงูุงู ุชูฺฏุฑุงู
- โ ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ูุฑ 6 ุณุงุนุช
- โ ุฐุฎุฑูโุณุงุฒ ุฏุงุฆู ุฏุงุฏูโูุง ุจุฑุง ููุงุณู

## โ๏ธ ูุญูู ุฑุงูโุงูุฏุงุฒ

### 1. Import ฺฉุฑุฏู Workflow

1. ูุงู `Research_Subjects_Scraper_Telegram.json` ุฑุง ุจุงุฒ ฺฉูุฏ
2. ูุญุชูุง ุขู ุฑุง ฺฉูพ ฺฉูุฏ
3. ุฏุฑ n8n ุจู ูุณูุช Workflows ุจุฑูุฏ
4. ุฑู ุฏฺฉูู Import ฺฉูฺฉ ฺฉูุฏ
5. ูุญุชูุง ุฑุง Paste ฺฉูุฏ

### 2. ุชูุธู Telegram Bot

ูุจู ุงุฒ ุงุณุชูุงุฏูุ ุจุงุฏ:

1. **ุงุฌุงุฏ Bot ุชูฺฏุฑุงู:**
   - ุจู [@BotFather](https://t.me/botfather) ุฏุฑ ุชูฺฏุฑุงู ูพุงู ุฏูุฏ
   - ุฏุณุชูุฑ `/newbot` ุฑุง ุงุฑุณุงู ฺฉูุฏ
   - ูุงู ู username ุจุฑุง bot ุฎูุฏ ุงูุชุฎุงุจ ฺฉูุฏ
   - Token ุฏุฑุงูุช ุฑุง ฺฉูพ ฺฉูุฏ

2. **ุฏุฑุงูุช Chat ID:**
   - Bot ุฑุง ุจู ฺฉุงูุงู ุฎูุฏ ุงุถุงูู ฺฉูุฏ ู Admin ฺฉูุฏ
   - ุง ุงุฒ [@userinfobot](https://t.me/userinfobot) ุจุฑุง ุฏุฑุงูุช Chat ID ุดุฎุต ุงุณุชูุงุฏู ฺฉูุฏ
   - ุจุฑุง ฺฉุงูุงูุ ูุนูููุงู Chat ID ุจู ุตูุฑุช `-100xxxxxxxxxx` ุงุณุช

3. **ุชูุธู Credentials ุฏุฑ n8n:**
   - ุฏุฑ n8n ุจู ูุณูุช Credentials ุจุฑูุฏ
   - ฺฉ Telegram API credential ุฌุฏุฏ ุงุฌุงุฏ ฺฉูุฏ
   - Token ุจุงุช ุฑุง ูุงุฑุฏ ฺฉูุฏ

4. **ุจูโุฑูุฒุฑุณุงู Workflow:**
   - Node "Send to Telegram" ุฑุง ุจุงุฒ ฺฉูุฏ
   - ุฏุฑ ูุณูุช `chatId` ุดูุงุณู ฺฉุงูุงู ุง ฺุช ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
   - Credential ุชูฺฏุฑุงู ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ

### 3. ุชูุธู ุฒูุงูโุจูุฏ (ุงุฎุชุงุฑ)

Node "Every 6 Hours" ุฑุง ูโุชูุงูุฏ ุชูุธู ฺฉูุฏ:
- ูุฑ ุณุงุนุช
- ูุฑ ุฑูุฒ
- ุง ูุฑ ุจุงุฒู ุฒูุงู ุฏูุฎูุงู

### 4. ูุนุงูโุณุงุฒ Workflow

- ุฑู ุฏฺฉูู "Active" ุฏุฑ ุจุงูุง ุตูุญู ฺฉูฺฉ ฺฉูุฏ
- Workflow ุจูโุทูุฑ ุฎูุฏฺฉุงุฑ ุฏุฑ ุฒูุงูโูุง ุชุนูโุดุฏู ุงุฌุฑุง ูโุดูุฏ

## ๐งช ุชุณุช Workflow

ุจุฑุง ุชุณุช ุฏุณุช:
1. ุฑู node "Every 6 Hours" ฺฉูฺฉ ุฑุงุณุช ฺฉูุฏ
2. ฺฏุฒูู "Execute Node" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ููุชุธุฑ ุจูุงูุฏ ุชุง ุชูุงู nodeูุง ุงุฌุฑุง ุดููุฏ
4. ูุชุงุฌ ุฑุง ุฏุฑ ุชูฺฏุฑุงู ุจุฑุฑุณ ฺฉูุฏ

## ๐ ุณุงุฎุชุงุฑ Workflow

```
Every 6 Hours
    โ
Fetch Research Subjects Page (HTTP Request)
    โ
Parse HTML & Extract Data (Code)
    โ
Detect Changes (Code) โ ููุงุณู ุจุง ุฏุงุฏูโูุง ูุจู
    โ
Format Telegram Messages (Code) โ ุณุงุฎุช ูพุงู ุจุฑุง ููุงุฑุฏ ุฌุฏุฏ/ุชุบุฑ ุงูุชู
    โ
Should Send? (IF)
    โ
Wait Between Messages (Wait)
    โ
Send to Telegram (Telegram)
```

### ูุญูู ฺฉุงุฑ ุชุดุฎุต ุชุบุฑุงุช:

1. **ุงููู ุงุฌุฑุง:** ุชูุงู ููุถูุนุงุช ุจู ุนููุงู "ุฌุฏุฏ" ุดูุงุฎุชู ูโุดููุฏ ู ุงุฑุณุงู ูโุดููุฏ
2. **ุงุฌุฑุงูุง ุจุนุฏ:**
   - ููุถูุนุงุช ฺฉู ุนููุงู ุฌุฏุฏ ุฏุงุฑูุฏ โ ูพุงู "ููุถูุน ุฌุฏุฏ"
   - ููุถูุนุงุช ฺฉู ููุฏูุงุดุงู ุชุบุฑ ฺฉุฑุฏู โ ูพุงู "ุจูโุฑูุฒุฑุณุงู" ุจุง ููุงุด ุชุบุฑุงุช
   - ููุถูุนุงุช ุจุฏูู ุชุบุฑ โ ูพุงู ุงุฑุณุงู ููโุดูุฏ

## ๐จ ูุฑูุช ูพุงูโูุง

### ูพุงู ุฎูุงุตู (ุงุจุชุฏุง ูุฑ ุจูโุฑูุฒุฑุณุงู):
```
๐ ุจูโุฑูุฒุฑุณุงู ููุถูุนุงุช ุชุญููุงุช โ ุขุจูุง ูุดูุฏ

๐ ููุถูุนุงุช ุฌุฏุฏ: ฒ
๐ ููุถูุนุงุช ุจูโุฑูุฒุฑุณุงู ุดุฏู: ฑ

๐ ุฒูุงู ุจุฑุฑุณ: ฑดฐณ/ฐธ/ฑฐ ฑด:ณฐ

ุฏุฑ ูพุงูโูุง ุจุนุฏ ุฌุฒุฆุงุช ุงุฑุณุงู ูโุดูุฏ.
```

### ูพุงู ููุถูุน ุฌุฏุฏ:
```
๐ ููุถูุน ุชุญููุงุช ุฌุฏุฏ

๐ ุนููุงู:
[ุนููุงู ููุถูุน]

๐ ููุน:
[ููุน ุชุญูู]

โฐ ูููุช ุซุจุช ูพุฑููพูุฒุงู:
[ุชุงุฑุฎ ุจู ูุงุฑุณ]

๐ ุฌุฒุฆุงุช:
[ุฌุฒุฆุงุช ููุถูุน]

๐ ูุดุงูุฏู ุฏุฑ ุณุงุช

๐ค ููุถูุน ุฌุฏุฏ ุดูุงุฑู ฑ ุงุฒ ฒ
```

### ูพุงู ุจูโุฑูุฒุฑุณุงู ููุถูุน:
```
๐ ุจูโุฑูุฒุฑุณุงู ููุถูุน ุชุญููุงุช

๐ ุนููุงู:
[ุนููุงู ููุถูุน]

โ๏ธ ุชุบุฑุงุช:

โซ๏ธ ูููุช ุซุจุช ูพุฑููพูุฒุงู
   ูุจู: ฑดฐณ/ฐธ/ฑต
   ุฌุฏุฏ: ฑดฐณ/ฐน/ฐฑ โจ

๐ ุงุทูุงุนุงุช ฺฉุงูู ูุนู:

๐ ููุน: ูพุงุงูโูุงูู ฺฉุงุฑุดูุงุณ ุงุฑุดุฏ
โฐ ูููุช: ฑดฐณ/ฐน/ฐฑ
๐ ุฌุฒุฆุงุช: ุฌุฒุฆุงุช ููุถูุน

๐ ูุดุงูุฏู ุฏุฑ ุณุงุช

๐ค ุจูโุฑูุฒุฑุณุงู ุดูุงุฑู ฑ ุงุฒ ฑ
```

### ุฒูุงู ฺฉู ุชุบุฑ ูุจุงุดุฏ:
```
โ ุจุฑุฑุณ ุงูุฌุงู ุดุฏ

ูฺ ููุถูุน ุฌุฏุฏ ุง ุจูโุฑูุฒุฑุณุงู ุงูุช ูุดุฏ.
```

## ๐ง ุณูุงุฑุดโุณุงุฒ

### ุชุบุฑ Headers

ุงฺฏุฑ ุณุงุช ูุณุฏูุฏ ุดุฏุ ูโุชูุงูุฏ ุฏุฑ node "Fetch Research Subjects Page" Headers ุฑุง ุชุบุฑ ุฏูุฏ:
- User-Agent
- Accept-Language
- ู ุณุงุฑ headerูุง

### ุชุบุฑ ูพุงุฑุณุฑ HTML

ุฏุฑ node "Parse HTML & Extract Data" ูโุชูุงูุฏ:
- ุงูฺฏู regex ุฑุง ุจุฑุง ุงุณุชุฎุฑุงุฌ ุฏุงุฏูโูุง ุชุบุฑ ุฏูุฏ
- ุณุชููโูุง ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ
- ูุฑูุช ุฎุฑูุฌ ุฑุง ุชูุธู ฺฉูุฏ

### ุชุบุฑ ูุฑูุช ูพุงู

ุฏุฑ node "Format Telegram Messages":
- ุงููุฌโูุง ุฑุง ุชุบุฑ ุฏูุฏ
- ูุฑูุชโุจูุฏ Markdown ุฑุง ุดุฎุตโุณุงุฒ ฺฉูุฏ
- ููุฏูุง ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ

## โ๏ธ ูฺฉุงุช ููู

1. **ุฐุฎุฑูโุณุงุฒ ุฏุงุฏูโูุง:**
   - Workflow ุงุฒ **Workflow Static Data** ุจุฑุง ุฐุฎุฑูโุณุงุฒ ุฏุงุฆู ุงุณุชูุงุฏู ูโฺฉูุฏ
   - ุฏุงุฏูโูุง ุญุช ุจุนุฏ ุงุฒ restart ฺฉุฑุฏู n8n ุญูุธ ูโุดููุฏ
   - ุจุฑุง reset ฺฉุฑุฏู ุฏุงุฏูโูุง ู ุดุฑูุน ูุฌุฏุฏุ workflow ุฑุง ุบุฑูุนุงู ู ุฏูุจุงุฑู ูุนุงู ฺฉูุฏ

2. **ุชุดุฎุต ุชุบุฑุงุช:**
   - ุชุดุฎุต ุจุฑ ุงุณุงุณ **ุนููุงู ููุถูุน** ุงูุฌุงู ูโุดูุฏ (ุจู ุนููุงู ฺฉูุฏ ฺฉุชุง)
   - ุงฺฏุฑ ุนููุงู ุชุบุฑ ฺฉูุฏุ ุจู ุนููุงู ููุถูุน ุฌุฏุฏ ุดูุงุฎุชู ูโุดูุฏ
   - ุชุบุฑุงุช ุฏุฑ ููุนุ ูููุช ู ุฌุฒุฆุงุช ุจู ุทูุฑ ุฌุฏุงฺฏุงูู ุฑุฏุงุจ ูโุดููุฏ

3. **ูุญุฏูุฏุช Rate Limiting:**
   - Node "Wait Between Messages" ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุญุฏูุฏุช ุชูฺฏุฑุงู 2 ุซุงูู ุชุงุฎุฑ ุฏุงุฑุฏ
   - ุงฺฏุฑ ุชุนุฏุงุฏ ูพุงูโูุง ุฒุงุฏ ุงุณุชุ ุงู ููุฏุงุฑ ุฑุง ุงูุฒุงุด ุฏูุฏ

4. **ุจุฑุฑุณ ุณุงุฎุชุงุฑ ุณุงุช:**
   - ุงฺฏุฑ ุณุงุช ุชุบุฑ ฺฉุฑุฏุ ุจุงุฏ Code node ูพุงุฑุณุฑ ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ
   - ุงุจุชุฏุง ุตูุญู HTML ุฑุง ุฏุณุช ุจุฑุฑุณ ฺฉูุฏ

5. **ุงููุช:**
   - Token ุชูฺฏุฑุงู ุฎูุฏ ุฑุง ูุญููุธ ูฺฏู ุฏุงุฑุฏ
   - ุงุฒ Credentials n8n ุจู ุฌุง hard-coding ุงุณุชูุงุฏู ฺฉูุฏ

## ๐ ุนุจโุงุจ

### ูพุงู ุงุฑุณุงู ููโุดูุฏ
- Chat ID ุฑุง ุจุฑุฑุณ ฺฉูุฏ (ุจุงุฏ ุจุง `-` ุดุฑูุน ุดูุฏ ุจุฑุง ฺฉุงูุงู)
- Bot ุฑุง Admin ฺฉุงูุงู ฺฉูุฏ
- Credentials ุชูฺฏุฑุงู ุฑุง ฺฺฉ ฺฉูุฏ

### ุฏุงุฏู ุงุณุชุฎุฑุงุฌ ููโุดูุฏ
- ุณุงุฎุชุงุฑ HTML ุณุงุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ
- Code node "Parse HTML & Extract Data" ุฑุง debug ฺฉูุฏ
- Headers ุฏุฑุฎูุงุณุช HTTP ุฑุง ุจุฑุฑุณ ฺฉูุฏ

### ุชุบุฑุงุช ุชุดุฎุต ุฏุงุฏู ููโุดููุฏ
- ูุทูุฆู ุดูุฏ workflow ุญุฏุงูู ฺฉ ุจุงุฑ ุจุง ููููุช ุงุฌุฑุง ุดุฏู
- ุฏุฑ node "Detect Changes" ุฎุฑูุฌ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
- Workflow Static Data ุฑุง ฺฺฉ ฺฉูุฏ:
  - ุฏุฑ n8n ุจู Settings โ Variables ุจุฑูุฏ
  - ูุชุบุฑ `researchSubjects` ุฑุง ูพุฏุง ฺฉูุฏ
- ุงฺฏุฑ ุฏุงุฏูโูุง corrupted ุดุฏูุฏุ workflow ุฑุง ุบุฑูุนุงู ู ุฏูุจุงุฑู ูุนุงู ฺฉูุฏ

### ุชูุงู ููุถูุนุงุช ุจู ุนููุงู "ุฌุฏุฏ" ููุงุด ุฏุงุฏู ูโุดููุฏ
- ุงู ุฑูุชุงุฑ ุทุจุน ุฏุฑ ุงููู ุงุฌุฑุง ุงุณุช
- Static Data ุฑุง ุจุฑุฑุณ ฺฉูุฏุ ุงุญุชูุงูุงู ุฎุงู ุงุณุช
- ุจุนุฏ ุงุฒ ุงููู ุงุฌุฑุงุ ุงุฌุฑุง ุจุนุฏ ุจุงุฏ ุชุบุฑุงุช ุฑุง ุชุดุฎุต ุฏูุฏ

### ุฎุทุง 403
- User-Agent ุฑุง ุชุบุฑ ุฏูุฏ
- Headers ุจุดุชุฑ ุงุถุงูู ฺฉูุฏ
- ุงุฒ proxy ุงุณุชูุงุฏู ฺฉูุฏ (ุฏุฑ ุชูุธูุงุช n8n)

## ๐ ูุงุณูุณ

ุงู workflow ุจุฑุง ุงุณุชูุงุฏู ุดุฎุต ู ุขููุฒุด ุงุฑุงุฆู ุดุฏู ุงุณุช.

## ๐ค ูุดุงุฑฺฉุช

ุจุฑุง ฺฏุฒุงุฑุด ูุดฺฉู ุง ูพุดููุงุฏ ุจูุจูุฏุ Issue ุงุฌุงุฏ ฺฉูุฏ.

---

**ุณุงุฎุชู ุดุฏู ุจุง โค๏ธ ุจุฑุง ุฌุงูุนู n8n ูุงุฑุณโุฒุจุงูุงู**
