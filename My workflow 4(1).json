{
  "name": "My workflow 4",
  "nodes": [
    {
      "parameters": {
        "url": "={{ $json[\"link\"] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        256,
        -1232
      ],
      "id": "5e5d8d89-9540-4774-a691-46e570ae9185",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "url": "https://wesh.ir/feed/",
        "options": {}
      },
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1.2,
      "position": [
        -96,
        -896
      ],
      "id": "526eb62c-a4c1-49b4-a5e3-e8ee66eb6bcd",
      "name": "RSS Read"
    },
    {
      "parameters": {
        "operation": "extractHtmlContent",
        "extractionValues": {
          "values": [
            {
              "key": "title",
              "cssSelector": "title"
            },
            {
              "key": "content",
              "cssSelector": "p"
            },
            {
              "key": "imageUrl",
              "cssSelector": "figure.wp-block-image img[src*='/uploads/'], img[src*='/uploads/'][class*='wp-image-']",
              "returnValue": "attribute",
              "attribute": "src"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.html",
      "typeVersion": 1.2,
      "position": [
        384,
        -896
      ],
      "id": "e4d98a87-78ec-44ed-96de-1686df7243de",
      "name": "HTML"
    },
    {
      "parameters": {
        "jsCode": "const htmlData = $input.first().json;\nconst rssData = $input.all()[0].json; // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø§Ø² RSS\n\nconst title = htmlData.title || rssData.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';\nconst content = Array.isArray(htmlData.content) ? htmlData.content.join(' ') : (htmlData.content || '');\nconst link = rssData.link || '';\nconst imageUrl = htmlData.imageUrl || '';\n\n// ÙÛŒÙ„ØªØ± ØªØµØ§ÙˆÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø±\nconst invalidKeywords = ['aparat', 'logo', 'LOGO', 'icon', 'banner', 'avatar'];\nconst isValidImage = imageUrl && !invalidKeywords.some(k => imageUrl.toLowerCase().includes(k));\nconst finalImageUrl = isValidImage ? imageUrl : '';\n\n// Ø³Ø§Ø®Øª Ù…ØªÙ† Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ø±Ø®ÙˆØ§Ø³Øª JSON\nconst prompt = `Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ† Ø®Ø¨Ø± Ø±Ø§ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª Ø®Ù„Ø§ØµÙ‡ØŒ Ø±ÙˆØ§Ù† Ùˆ Ø¬Ø°Ø§Ø¨ Ø®Ù„Ø§ØµÙ‡ Ú©Ù† (Ø­Ø¯Ø§Ú©Ø«Ø± Û³ Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù).\\n\\nÙ…ØªÙ† Ø®Ø¨Ø±:\\n${content}\\n\\nØ®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø­ØªÙ…Ø§Ù‹ Ø¨Ù‡ ØµÙˆØ±Øª JSON Ø¨Ø§ ÙØ±Ù…Øª Ø²ÛŒØ± Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†:\\n{\\n  \"title\": \"${title}\",\\n  \"summary\": \"Ù…ØªÙ† Ø®Ù„Ø§ØµÙ‡ Ø´Ø¯Ù‡\",\\n  \"imageUrl\": \"${finalImageUrl}\",\\n  \"link\": \"${link}\"\\n}`;\n\nreturn [{\n  json: {\n    prompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        624,
        -1248
      ],
      "id": "3bfee3de-94de-42c0-a421-a4b7aada4e38",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "-1003140416257",
        "file": "={{ $json.photo }}",
        "additionalFields": {
          "caption": "={{ $json.caption }}",
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1344,
        -1088
      ],
      "id": "9a2c38e8-9179-4f29-b5e8-edc751f56354",
      "name": "Send a photo message",
      "webhookId": "0f87e073-af12-400a-906e-6b55dfca20c7",
      "credentials": {
        "telegramApi": {
          "id": "w3HIcBgC88omBsJ7",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const item = $input.item.json;\n\n// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù¾Ø§Ø³Ø® Gemini\nconst response = item.candidates[0].content.parts[0].text;\n\n// Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ùˆ parse Ú©Ø±Ø¯Ù† JSON\nlet cleanResponse = response.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\nlet parsedData;\ntry {\n    parsedData = JSON.parse(cleanResponse);\n} catch (e) {\n    console.error('Parse error:', e);\n    return [];\n}\n\n// ÙØ±Ù…Øª Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…\nconst title = parsedData.title || '';\nlet summary = parsedData.summary || '';\nconst imageUrl = parsedData.imageUrl || '';\nconst link = parsedData.link || '';\n\n// Ø³Ø§Ø®Øª Ù¾ÛŒØ§Ù… Ø¨Ø§ ÙØ±Ù…Øª HTML Ùˆ Ø§ÛŒÙ…ÙˆØ¬ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ\nlet caption = `ğŸ“° <b>${title}</b>\\n\\n${summary}\\n\\nğŸ”— <a href=\"${link}\">Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø·Ù„Ø¨ Ø¯Ø± ÙˆØ¨Ø³Ø§ÛŒØª</a>\\n\\nğŸ“¡ @wesh_ir`;\n\n// Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† caption Ø¨Ù‡ 950 Ú©Ø§Ø±Ø§Ú©ØªØ± (ØªÙ„Ú¯Ø±Ø§Ù… Ø­Ø¯Ø§Ú©Ø«Ø± 1024 Ø¯Ø§Ø±Ø¯)\nif (caption.length > 950) {\n  const maxSummaryLength = 950 - title.length - link.length - 100; // 100 Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ…ÙˆØ¬ÛŒ Ùˆ ÙØ±Ù…Øª\n  summary = summary.substring(0, maxSummaryLength) + '...';\n  caption = `ğŸ“° <b>${title}</b>\\n\\n${summary}\\n\\nğŸ”— <a href=\"${link}\">Ø§Ø¯Ø§Ù…Ù‡ Ù…Ø·Ù„Ø¨ Ø¯Ø± ÙˆØ¨Ø³Ø§ÛŒØª</a>\\n\\nğŸ“¡ @wesh_ir`;\n}\n\nreturn [{\n    json: {\n        caption: caption,\n        photo: imageUrl,\n        hasImage: Boolean(imageUrl && !imageUrl.toLowerCase().includes('logo'))\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        -1104
      ],
      "id": "0d5e5061-2b99-46d3-a507-a84fb7ef6ed5",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtMinute": 15
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -240,
        -1104
      ],
      "id": "52c4a316-39c9-48b7-8cf8-80307ae81243",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=AIzaSyDjuVZgrG_jwRm1qGcvW2IpW4qAjis3dD4",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ {\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\": $json.prompt\n        }\n      ]\n    }\n  ]\n} }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        848,
        -1328
      ],
      "id": "903565e5-cc7c-4ac1-aa52-58c1e6d63369",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nreturn items.map(item => {\n  try {\n    const decodedLink = decodeURIComponent(item.json.link);\n    return { json: { ...item.json, link: decodedLink } };\n  } catch (e) {\n    return item;\n  }\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        -1312
      ],
      "id": "b50ae6bf-8bb5-4280-9aa9-da09e91d0956",
      "name": "Code in JavaScript3"
    }
  ],
  "pinData": {},
  "connections": {
    "RSS Read": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a photo message": {
      "main": [
        []
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Send a photo message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "RSS Read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "HTML",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTML": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "532ee310-11b6-4ebb-9e1f-000f7060cd8f",
  "meta": {
    "instanceId": "e9ab7552981b4061a4ecd9f94dfb88c0d9ea8398e961467ddb816643976354e1"
  },
  "id": "2oVqZwqOndyErqhS",
  "tags": []
}